<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Mind</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="css/styles.css?v=2">
</head>
<body>
    <div id="app">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon"><i class="ph ph-brain"></i></div>
                    <span>Mind</span>
                </div>
            </div>

            <div class="sidebar-search">
                <input type="text" class="search-input" id="searchInput" placeholder="Search notes...">
                <div class="search-results" id="searchResults"></div>
            </div>

            <div class="sidebar-content">
                <div class="sidebar-section">
                    <div class="section-header" data-section="folders">
                        <span>Folders</span>
                        <div class="section-actions">
                            <button class="section-action-btn" id="addFolderBtn" title="Add new folder">+</button>
                        </div>
                    </div>
                    <div class="section-content" id="foldersSection">
                        <ul class="folder-tree" id="folderTree"></ul>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-header" data-section="tags">
                        <span>Tags</span>
                    </div>
                    <div class="section-content" id="tagsSection">
                        <div class="tags-search">
                            <input type="text" class="tags-search-input" id="tagsSearch" placeholder="Search tags...">
                        </div>
                        <div class="tags-alphabetical" id="tagsAlphabetical"></div>
                    </div>
                </div>
            </div>

            <div class="sidebar-actions">
                <button class="btn btn-secondary btn-icon" id="settingsBtn" title="Settings">
                    <i class="ph ph-gear"></i>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main" id="main">
            <header class="main-header">
                <div class="header-left">
                    <div class="breadcrumb" id="breadcrumb">
                        <span class="breadcrumb-item" data-folder="root">All Notes</span>
                    </div>
                </div>
                <div class="header-right">
                    <span class="header-title" id="headerTitle"></span>
                    <button class="btn btn-icon" id="themeBtn" title="Toggle Theme">
                        <i class="ph ph-moon"></i>
                    </button>
                </div>
            </header>

            <div class="editor-container" id="editorContainer">
                <div class="empty-state" id="emptyState">
                    <div class="empty-state-icon"><i class="ph ph-brain ph-xl"></i></div>
                    <div class="empty-state-title">Welcome to Mind</div>
                    <div class="empty-state-desc">
                        Your private, offline knowledge management system.
                        Create your first note to get started.
                    </div>
                    <button class="btn btn-primary" id="emptyNewNoteBtn">
                        <i class="ph ph-plus"></i> Create First Note
                    </button>
                </div>

                <div class="editor-toolbar hidden" id="editorToolbar" style="display: none !important;">
                    <div class="toolbar-group">
                        <button class="toolbar-btn" data-command="bold" title="Bold"><i class="ph ph-text-b"></i></button>
                        <button class="toolbar-btn" data-command="italic" title="Italic"><i class="ph ph-text-italic"></i></button>
                        <button class="toolbar-btn" data-command="underline" title="Underline"><i class="ph ph-text-underline"></i></button>
                        <button class="toolbar-btn" data-command="strikeThrough" title="Strikethrough"><i class="ph ph-text-strikethrough"></i></button>
                    </div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn" data-command="formatBlock" data-value="H1" title="Heading 1"><i class="ph ph-text-h-one"></i></button>
                        <button class="toolbar-btn" data-command="formatBlock" data-value="H2" title="Heading 2"><i class="ph ph-text-h-two"></i></button>
                        <button class="toolbar-btn" data-command="formatBlock" data-value="H3" title="Heading 3"><i class="ph ph-text-h-three"></i></button>
                    </div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn" data-command="insertUnorderedList" title="Bullet List"><i class="ph ph-list-bullets"></i></button>
                        <button class="toolbar-btn" data-command="insertOrderedList" title="Numbered List"><i class="ph ph-list-numbers"></i></button>
                        <button class="toolbar-btn" data-command="formatBlock" data-value="BLOCKQUOTE" title="Quote"><i class="ph ph-quotes"></i></button>
                    </div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn" data-command="createLink" title="Insert Link"><i class="ph ph-link"></i></button>
                        <button class="toolbar-btn" data-command="insertImage" title="Insert Image"><i class="ph ph-image"></i></button>
                        <button class="toolbar-btn" data-command="insertCodeBlock" title="Code Block"><i class="ph ph-code"></i></button>
                    </div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn" id="aiAssistBtn" title="AI Assist"><i class="ph ph-sparkle"></i></button>
                    </div>
                </div>

                <div class="tabs-bar hidden" id="tabsBar"></div>

                <div class="editor-content-wrapper hidden" id="editorContentWrapper">
                    <div class="editor-content">
                        <input type="text" class="note-title-input" id="noteTitle" placeholder="Note Title">
                        <div class="note-meta">
                            <span id="noteDate">Created today</span>
                            <div class="note-tags-input" id="noteTagsInput">
                                <input type="text" class="tag-input" id="tagInput" placeholder="Add tag...">
                                <div class="tag-autocomplete" id="tagAutocomplete" style="display: none;"></div>
                            </div>
                            <button class="btn btn-secondary" id="suggestTagsBtn"><i class="ph ph-sparkle"></i> AI Tags</button>
                        </div>

                        <div class="note-tabs">
                            <button class="note-tab active" data-tab="note">Note</button>
                            <button class="note-tab" data-tab="summary">Summary</button>
                            <button class="note-tab" data-tab="tasks">Tasks</button>
                        </div>

                        <div class="note-tab-content" id="noteTabContent">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <select id="templateSelect" style="background: transparent; border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 6px 10px; font-size: 12px; color: var(--text-secondary); cursor: pointer;">
                                    <option value="">Template</option>
                                    <option value="save-current">+ Save as Template</option>
                                </select>
                            </div>
                            <div class="wysiwyg-editor" id="wysiwygEditor" contenteditable="true"></div>
                        </div>

                        <div class="note-tab-content" id="summaryTabContent" style="display: none;"></div>

                        <div class="note-tab-content" id="tasksTabContent" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Settings</h3>
                <button class="modal-close" id="closeSettings">
                    <i class="ph ph-x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>Appearance</h4>
                    <div class="setting-item">
                        <label>Theme</label>
                        <select id="themeSelect">
                            <option value="auto">Auto (System)</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>AI Integration</h4>
                    <div class="setting-item">
                        <label>AI Provider</label>
                        <select id="aiProviderSelect">
                            <option value="ollama">Ollama (Local)</option>
                            <option value="webllm">WebLLM (Browser)</option>
                            <option value="demo">Demo Mode</option>
                        </select>
                    </div>
                    <div class="setting-item" id="ollamaSettings">
                        <label>Ollama URL</label>
                        <input type="text" id="ollamaUrl" value="http://localhost:11434" placeholder="http://localhost:11434">
                        <label style="margin-top: 8px;">Model</label>
                        <input type="text" id="ollamaModel" value="llama3.2" placeholder="llama3.2">
                    </div>
                </div>

                <div class="settings-section">
                    <h4>Data Management</h4>
                    <div class="setting-actions">
                        <button class="btn btn-secondary" id="exportBtn">
                            <i class="ph ph-download"></i> Export Data
                        </button>
                        <button class="btn btn-secondary" id="importBtn">
                            <i class="ph ph-upload"></i> Import Data
                        </button>
                        <button class="btn btn-danger" id="clearDataBtn">
                            <i class="ph ph-trash"></i> Clear All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trash Modal -->
    <div class="modal" id="trashModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Trash</h3>
                <button class="modal-close" id="closeTrash">
                    <i class="ph ph-x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="trashEmptyState" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="ph ph-trash" style="font-size: 48px; margin-bottom: 16px; display: block;"></i>
                    <p>Trash is empty</p>
                </div>
                <div id="trashItemsList" style="display: none;">
                    <div id="trashItemsContainer"></div>
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
                        <button class="btn btn-danger" id="emptyTrashBtn">
                            <i class="ph ph-trash"></i> Empty Trash
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal" id="imageModal">
        <div class="modal-content" style="max-width: 90vw; max-height: 90vh; padding: 0; background: transparent; border: none;">
            <div style="position: relative;">
                <button class="modal-close" id="closeImageModal" style="position: absolute; top: -40px; right: 0; background: rgba(0,0,0,0.8); color: white; border-radius: 50%; width: 32px; height: 32px;">
                    <i class="ph ph-x"></i>
                </button>
                <img id="modalImage" src="" alt="Full size" style="max-width: 100%; max-height: 85vh; border-radius: 8px; display: block;">
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Hidden file input -->
    <input type="file" id="importInput" accept=".json,.md,.markdown" hidden>

    <script src="js/app.js?v=2"></script>
</body>
</html>
